<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viral Post Analyzer | Antigravity</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F1F5F9;
            /* Slate 100 */
            color: #1E293B;
            /* Slate 800 */
        }

        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .harm-badge {
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .harm-health {
            background: #10B981;
            color: #fff;
        }

        .harm-ambition {
            background: #3B82F6;
            color: #fff;
        }

        .harm-relation {
            background: #EC4899;
            color: #fff;
        }

        .harm-money {
            background: #F59E0B;
            color: #fff;
        }

        .harm-other {
            background: #64748B;
            color: #fff;
        }

        /* Custom Scrollbar for Textarea */
        textarea::-webkit-scrollbar {
            width: 8px;
        }

        textarea::-webkit-scrollbar-track {
            background: #1e293b;
        }

        textarea::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        textarea::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            // State
            const [apiKey, setApiKey] = useState("");
            const [models, setModels] = useState([]);
            const [selectedModel, setSelectedModel] = useState("");
            const [inputText, setInputText] = useState("");
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);

            // Load saved API key on mount
            useEffect(() => {
                const savedKey = localStorage.getItem('gemini_api_key');
                if (savedKey) setApiKey(savedKey);
            }, []);

            // 1. Fetch Models
            const fetchModels = async () => {
                if (!apiKey) {
                    alert("APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
                    return;
                }
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                    if (!response.ok) throw new Error("APIã‚­ãƒ¼ãŒé–“é•ã£ã¦ã„ã‚‹ã‹ã€æ¥ç¶šã‚¨ãƒ©ãƒ¼ã§ã™ã€‚");

                    const data = await response.json();
                    const usableModels = data.models.filter(m =>
                        m.supportedGenerationMethods && m.supportedGenerationMethods.includes("generateContent")
                    );

                    // Prioritize Gemini models and sort
                    usableModels.sort((a, b) => b.name.localeCompare(a.name));

                    const formattedModels = usableModels.map(m => ({
                        id: m.name.replace('models/', ''),
                        name: `${m.displayName} (${m.name.replace('models/', '')})`
                    }));

                    setModels(formattedModels);
                    if (formattedModels.length > 0) {
                        // Auto-select flash or pro if available, otherwise first
                        const defaultModel = formattedModels.find(m => m.id.includes('flash')) || formattedModels[0];
                        setSelectedModel(defaultModel.id);
                    }

                    // Save key
                    localStorage.setItem('gemini_api_key', apiKey);
                    setError(null);

                } catch (e) {
                    console.error(e);
                    setError(e.message);
                }
            };

            // 2. Analyze Post
            const analyzePost = async () => {
                if (!inputText.trim() || !apiKey || !selectedModel) return;
                setIsAnalyzing(true);
                setError(null);
                setResult(null);

                const systemPrompt = `
ã‚ãªãŸã¯SNSãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ—ãƒ­ã§ã™ã€‚å…¥åŠ›ã•ã‚ŒãŸæŠ•ç¨¿ã‚’åˆ†æã—ã€**å³å¯†ãªJSONå½¢å¼ã®ã¿**ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆ\`\`\`json ... \`\`\`ï¼‰ã¯ä¸è¦ã§ã™ã€‚ç´”ç²‹ãªJSONæ–‡å­—åˆ—ã ã‘ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚

ã€åˆ†æè¦³ç‚¹ã€‘
1. viralScore: 0-100ã®ãƒã‚ºã‚Šãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚¹ã‚³ã‚¢ï¼ˆæ¨å®šï¼‰
2. harmType: ä»¥ä¸‹ã®ã„ãšã‚Œã‹ (Health, Ambition, Relation, Money, Other)
3. structure: "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å‹", "ãƒã‚¦ãƒã‚¦å‹", "å¯¾ç«‹ç…½ã‚Šå‹" ãªã©ã®æ§‹é€ åˆ†é¡
4. keyHooks: èª­è€…ã‚’æƒ¹ãã¤ã‘ãŸå¿ƒç†çš„ãƒ•ãƒƒã‚¯ã®è¦ç´ ï¼ˆ3ã¤ç¨‹åº¦ï¼‰
5. improvement: ã•ã‚‰ã«ä¼¸ã°ã™ãŸã‚ã®å…·ä½“çš„ãªæ”¹å–„æ¡ˆï¼ˆRisu Style: ä¸å¯§ã ãŒæŒ‡æ‘˜ã¯é‹­ãã€çµµæ–‡å­—ãªã—ï¼‰

ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
{
  "viralScore": 85,
  "harmType": "Money",
  "structure": "éå¸¸è­˜ãªæˆåŠŸæ³•å‰‡å‹",
  "keyHooks": ["æå¤±å›é¿", "æ¨©å¨æ€§", "ç°¡æ˜“æ€§"],
  "improvement": "å†’é ­ã®2è¡Œç›®ã§..."
}
`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${selectedModel}:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: systemPrompt + "\n\nã€åˆ†æå¯¾è±¡ã®æŠ•ç¨¿ã€‘\n" + inputText }]
                            }]
                        })
                    });

                    if (!response.ok) throw new Error("ç”Ÿæˆã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");

                    const data = await response.json();
                    let rawText = data.candidates[0].content.parts[0].text;

                    // Clean up markdown code blocks if present
                    rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();

                    const jsonResult = JSON.parse(rawText);
                    setResult(jsonResult);

                } catch (e) {
                    console.error(e);
                    setError("åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚\n" + e.message);
                } finally {
                    setIsAnalyzing(false);
                }
            };

            return (
                <div className="container mx-auto px-4 py-8 max-w-3xl">
                    <header className="flex justify-between items-center mb-10">
                        <div className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-500">
                            Viral Post Analyzer <span className="text-xs text-slate-500 ml-2">v1.0</span>
                        </div>
                        <div className="text-sm text-slate-400">Powered by Gemini API</div>
                    </header>

                    <div className="grid gap-8">
                        {/* API Config Section */}
                        <section className="glass rounded-2xl p-6 shadow-xl border-l-4 border-cyan-500">
                            <h3 className="text-white font-bold mb-4 flex items-center gap-2">
                                <span>ğŸ”‘</span> API Connection
                            </h3>
                            <div className="flex gap-2 mb-4">
                                <input
                                    type="password"
                                    className="flex-1 bg-slate-900/50 border border-slate-700 rounded-lg p-2 text-white"
                                    placeholder="API Key (AIza...)"
                                    value={apiKey}
                                    onChange={(e) => setApiKey(e.target.value)}
                                />
                                <button
                                    onClick={fetchModels}
                                    className="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg font-bold transition"
                                >
                                    Connect
                                </button>
                            </div>
                            {models.length > 0 && (
                                <select
                                    className="w-full bg-slate-900/50 border border-slate-700 rounded-lg p-2 text-white"
                                    value={selectedModel}
                                    onChange={(e) => setSelectedModel(e.target.value)}
                                >
                                    {models.map(m => <option key={m.id} value={m.id}>{m.name}</option>)}
                                </select>
                            )}
                            {error && <p className="text-red-400 text-sm mt-2">{error}</p>}
                        </section>

                        {/* Input Section */}
                        <section className="glass rounded-2xl p-6 shadow-xl">
                            <div className="flex justify-between items-center mb-2">
                                <label className="block text-sm font-medium text-slate-600">
                                    åˆ†æã—ãŸã„æŠ•ç¨¿ï¼ˆX / Threadsï¼‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
                                </label>
                                <button
                                    onClick={() => { setInputText(""); setResult(null); }}
                                    className="text-xs text-slate-500 hover:text-red-500 transition underline"
                                >
                                    ã‚¯ãƒªã‚¢ (Clear)
                                </button>
                            </div>
                            <textarea
                                className="w-full h-40 bg-white border border-slate-300 rounded-xl p-4 text-slate-800 focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
                                placeholder="ä¾‹ï¼šAIã‚’ä½¿ã£ã¦æœˆ5ä¸‡ç¨¼ãæ–¹æ³•ã€‚å®Ÿã¯... (ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒšãƒ¼ã‚¹ãƒˆ)"
                                value={inputText}
                                onChange={(e) => setInputText(e.target.value)}
                            ></textarea>
                            <button
                                onClick={analyzePost}
                                disabled={isAnalyzing || !inputText.trim() || !selectedModel}
                                className={`mt-4 w-full py-3 rounded-xl font-bold text-white transition transform hover:scale-[1.02] ${isAnalyzing || !selectedModel
                                    ? "bg-slate-400 cursor-not-allowed"
                                    : "bg-gradient-to-r from-blue-600 to-cyan-500 hover:shadow-lg hover:shadow-blue-500/30"
                                    }`}
                            >
                                {isAnalyzing ? "AIãŒåˆ†æä¸­..." : "åˆ†æã™ã‚‹ (Analyze)"}
                            </button>
                        </section>

                        {/* Result Section */}
                        {result && (
                            <section className="glass rounded-2xl p-6 border-cyan-500/30 shadow-2xl animate-fade-in-up">
                                <div className="flex justify-between items-start mb-6">
                                    <div>
                                        <h2 className="text-xl font-bold text-white mb-1">Analysis Result</h2>
                                        <p className="text-sm text-slate-400">AIã«ã‚ˆã‚‹æŠ•ç¨¿è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ</p>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-xs text-slate-400 uppercase tracking-widest">Viral Potential</div>
                                        <div className="text-3xl font-black text-cyan-400">{result.viralScore}<span className="text-sm text-slate-600">/100</span></div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                                        <div className="text-xs text-slate-400 mb-1">HARMã‚¸ãƒ£ãƒ³ãƒ«</div>
                                        <span className={`harm-badge harm-${result.harmType ? result.harmType.toLowerCase() : 'other'}`}>
                                            {result.harmType || 'Other'}
                                        </span>
                                    </div>
                                    <div className="bg-white border border-slate-200 p-4 rounded-xl shadow-sm">
                                        <div className="text-xs text-slate-500 mb-1">æ–‡ç« æ§‹é€ </div>
                                        <div className="font-bold text-slate-900">{result.structure}</div>
                                    </div>
                                </div>

                                <div className="mb-6">
                                    <div className="text-sm font-bold text-slate-700 mb-2">ãƒ•ãƒƒã‚¯ã®è¦ç´  (Why it works)</div>
                                    <div className="flex flex-wrap gap-2">
                                        {result.keyHooks && result.keyHooks.map((hook, i) => (
                                            <span key={i} className="bg-slate-100 text-slate-800 px-3 py-1 rounded-lg text-sm border border-slate-200 font-medium">
                                                #{hook}
                                            </span>
                                        ))}
                                    </div>
                                </div>

                                <div className="bg-blue-50 border border-blue-100 p-4 rounded-xl">
                                    <div className="flex items-start gap-3">
                                        <div className="text-xl">ğŸ’¡</div>
                                        <div>
                                            <div className="text-sm font-bold text-blue-800 mb-1">AIã‹ã‚‰ã®æ”¹å–„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</div>
                                            <p className="text-sm text-slate-900 leading-relaxed font-medium">
                                                {result.improvement}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>

</html>